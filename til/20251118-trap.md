# 20251118 - trap

## trap command

trap은 bash의 builtin command 이다.
현재 shell이 받는 signal에 대한 signal handler를 설정한다.

기본적인 사용 형태는 `trap [arg] [signal0] [signal1] ...` 이다.
지정한 signal들에 대해 arg를 실행하도록 한다.
이전에 지정했던 signal은 override 된다.

signal들은 `signal` function과 같이 지정하면 된다.

EXIT과 같이 bash 내에서만 작동하는 것들이 있다.

SIGKILL에 대해선 지정할 수 없다.
애초에 bash 상에서 프로세스가 핸들러를 설정할 수 없으니 구현할 수 없다.

## 사용

```bash
#! /bin/bash

trap "echo kill???; exit" KILL # (1)
trap "echo terminated; exit" TERM # (2)
trap "echo interrupted; exit" 2 # (3)
trap "echo interrupted 2; exit" 2 # (4)
trap "echo exited" EXIT # (5)
trap "echo exited 2" EXIT # (6)

while true; do
    echo "hi"
    sleep 1
done
```

1) SIGKILL에 대한 핸들러를 달려고 시도하였다.
2) SIGTERM 핸들러를 추가하였다.
3) SIGINT의 numeric value로 시그널을 명시하였다.
4) 같은 시그널에 대한 핸들러를 중복 적용하는 것을 테스트한다.
5) EXIT은 종료되기 전 실행되는 특수 시그널이다.
6) EXIT과 같은 특수 시그널의 중복 적용을 테스트한다.

### SIGINT

스크립트 실행 중 ^C로 SIGINT를 걸었다.
```
./test.bash
hi
hi
^Cinterrupted 2
exited 2
```

SIGINT, EXIT 핸들러를 2개씩 달았지만 가장 마지막에 적용한 것만 발동되었다.
중복 적용 시 이전 핸들러는 덮어씌워짐을 알 수 있다.

### SIGTERM

```
./test.bash
hi
hi
terminated
exited 2
```

### SIGKILL

핸들러 적용 없이 바로 exit 되는 것을 확인할 수 있었다.
